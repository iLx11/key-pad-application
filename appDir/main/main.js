"use strict";const oe=require("electron"),q=require("path"),gt=require("fs"),fn=require("constants"),mn=require("stream"),vt=require("util"),yn=require("assert"),{ipcMain:Pe,BrowserWindow:ke}=require("electron"),dn=()=>{Pe.on("window-min",e=>{const t=e.sender;ke.fromWebContents(t).minimize()}),Pe.on("window-max",e=>{const t=e.sender,n=ke.fromWebContents(t);n.isMaximized()?n.unmaximize():n.maximize()}),Pe.on("window-close",e=>{const t=e.sender;ke.fromWebContents(t).close()})},hn=require("path"),Me=class H{constructor(){this.getWindowById=t=>oe.BrowserWindow.fromId(t),this.defaultConfig={id:null,title:"",width:null,height:null,minWidth:null,minHeight:null,route:"",resizable:!0,maximize:!1,backgroundColor:"#eee",data:null,isMultiWindow:!1,isMainWin:!1,parentId:null,modal:!0},this.defaultOptions={width:900,height:700,center:!0,frame:!1,show:!0,transparent:!0,maxWidth:null,maxHeight:null,minWidth:680,minHeight:500,backgroundColor:"rgba(0,0,0,0)",autoHideMenuBar:!0,resizable:!0,minimizable:!0,maximizable:!0,modal:!0,parent:null,webPreferences:{contextIsolation:!0,webSecurity:!1,nodeIntegration:!0,preload:hn.join(__dirname,"../preload/preload.js")}}}createWindow(t,n){var l;let i=0;if(H.group.some((u,f)=>(i=f,u.route===t.route))){console.info("window is already created"),(l=this.getWindowById(i+1))==null||l.blur();return}let r=Object.assign({},this.defaultConfig,t),o=Object.assign({},this.defaultOptions,n);!r.isMainWin&&H.main&&(o.parent=H.main);let a=new oe.BrowserWindow(o);console.log("window id:"+a.id),H.group[a.id-1]={windowId:a.id,route:r.route},r.maximize&&r.resizable&&a.maximize(),r.isMainWin&&(H.main&&(console.info("main window already created"),delete H.group[0],H.main.close()),H.main=a);let c=this;a.on("close",()=>{H.group.forEach((u,f)=>{this.getWindowById(u.windowId)==a&&delete H.group[f],a==c.main&&oe.app.quit()}),a.setOpacity(0)});let s;return oe.app.isPackaged?a.loadFile(q.join(__dirname,"../../dist/index.html"),{hash:r.route}):(s=r.route?`http://localhost:${process.env.VITE_DEV_SERVER_PORT}/#${r.route}`:`http://localhost:${process.env.VITE_DEV_SERVER_PORT}/#`,a.loadURL(s)),console.info("new window address -> ",s),a.setMenu(null),a.on("hide",()=>a.webContents.closeDevTools()),oe.globalShortcut.register("CommandOrControl+Shift+i",function(){a.webContents.openDevTools()}),a.once("ready-to-show",()=>{a.show()}),a}};Me.group=[];Me.main=null;let $t=Me;var Ie=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Q={},M={};M.fromCallback=function(e){return Object.defineProperty(function(...t){if(typeof t[t.length-1]=="function")e.apply(this,t);else return new Promise((n,i)=>{e.call(this,...t,(r,o)=>r!=null?i(r):n(o))})},"name",{value:e.name})};M.fromPromise=function(e){return Object.defineProperty(function(...t){const n=t[t.length-1];if(typeof n!="function")return e.apply(this,t);e.apply(this,t.slice(0,-1)).then(i=>n(null,i),n)},"name",{value:e.name})};var z=fn,wn=process.cwd,pe=null,pn=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return pe||(pe=wn.call(process)),pe};try{process.cwd()}catch{}if(typeof process.chdir=="function"){var Ke=process.chdir;process.chdir=function(e){pe=null,Ke.call(process,e)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,Ke)}var Sn=gn;function gn(e){z.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&t(e),e.lutimes||n(e),e.chown=o(e.chown),e.fchown=o(e.fchown),e.lchown=o(e.lchown),e.chmod=i(e.chmod),e.fchmod=i(e.fchmod),e.lchmod=i(e.lchmod),e.chownSync=a(e.chownSync),e.fchownSync=a(e.fchownSync),e.lchownSync=a(e.lchownSync),e.chmodSync=r(e.chmodSync),e.fchmodSync=r(e.fchmodSync),e.lchmodSync=r(e.lchmodSync),e.stat=c(e.stat),e.fstat=c(e.fstat),e.lstat=c(e.lstat),e.statSync=s(e.statSync),e.fstatSync=s(e.fstatSync),e.lstatSync=s(e.lstatSync),e.chmod&&!e.lchmod&&(e.lchmod=function(u,f,y){y&&process.nextTick(y)},e.lchmodSync=function(){}),e.chown&&!e.lchown&&(e.lchown=function(u,f,y,m){m&&process.nextTick(m)},e.lchownSync=function(){}),pn==="win32"&&(e.rename=typeof e.rename!="function"?e.rename:function(u){function f(y,m,d){var E=Date.now(),v=0;u(y,m,function P(b){if(b&&(b.code==="EACCES"||b.code==="EPERM"||b.code==="EBUSY")&&Date.now()-E<6e4){setTimeout(function(){e.stat(m,function(N,ie){N&&N.code==="ENOENT"?u(y,m,P):d(b)})},v),v<100&&(v+=10);return}d&&d(b)})}return Object.setPrototypeOf&&Object.setPrototypeOf(f,u),f}(e.rename)),e.read=typeof e.read!="function"?e.read:function(u){function f(y,m,d,E,v,P){var b;if(P&&typeof P=="function"){var N=0;b=function(ie,Ye,Ge){if(ie&&ie.code==="EAGAIN"&&N<10)return N++,u.call(e,y,m,d,E,v,b);P.apply(this,arguments)}}return u.call(e,y,m,d,E,v,b)}return Object.setPrototypeOf&&Object.setPrototypeOf(f,u),f}(e.read),e.readSync=typeof e.readSync!="function"?e.readSync:function(u){return function(f,y,m,d,E){for(var v=0;;)try{return u.call(e,f,y,m,d,E)}catch(P){if(P.code==="EAGAIN"&&v<10){v++;continue}throw P}}}(e.readSync);function t(u){u.lchmod=function(f,y,m){u.open(f,z.O_WRONLY|z.O_SYMLINK,y,function(d,E){if(d){m&&m(d);return}u.fchmod(E,y,function(v){u.close(E,function(P){m&&m(v||P)})})})},u.lchmodSync=function(f,y){var m=u.openSync(f,z.O_WRONLY|z.O_SYMLINK,y),d=!0,E;try{E=u.fchmodSync(m,y),d=!1}finally{if(d)try{u.closeSync(m)}catch{}else u.closeSync(m)}return E}}function n(u){z.hasOwnProperty("O_SYMLINK")&&u.futimes?(u.lutimes=function(f,y,m,d){u.open(f,z.O_SYMLINK,function(E,v){if(E){d&&d(E);return}u.futimes(v,y,m,function(P){u.close(v,function(b){d&&d(P||b)})})})},u.lutimesSync=function(f,y,m){var d=u.openSync(f,z.O_SYMLINK),E,v=!0;try{E=u.futimesSync(d,y,m),v=!1}finally{if(v)try{u.closeSync(d)}catch{}else u.closeSync(d)}return E}):u.futimes&&(u.lutimes=function(f,y,m,d){d&&process.nextTick(d)},u.lutimesSync=function(){})}function i(u){return u&&function(f,y,m){return u.call(e,f,y,function(d){l(d)&&(d=null),m&&m.apply(this,arguments)})}}function r(u){return u&&function(f,y){try{return u.call(e,f,y)}catch(m){if(!l(m))throw m}}}function o(u){return u&&function(f,y,m,d){return u.call(e,f,y,m,function(E){l(E)&&(E=null),d&&d.apply(this,arguments)})}}function a(u){return u&&function(f,y,m){try{return u.call(e,f,y,m)}catch(d){if(!l(d))throw d}}}function c(u){return u&&function(f,y,m){typeof y=="function"&&(m=y,y=null);function d(E,v){v&&(v.uid<0&&(v.uid+=4294967296),v.gid<0&&(v.gid+=4294967296)),m&&m.apply(this,arguments)}return y?u.call(e,f,y,d):u.call(e,f,d)}}function s(u){return u&&function(f,y){var m=y?u.call(e,f,y):u.call(e,f);return m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),m}}function l(u){if(!u||u.code==="ENOSYS")return!0;var f=!process.getuid||process.getuid()!==0;return!!(f&&(u.code==="EINVAL"||u.code==="EPERM"))}}var Qe=mn.Stream,vn=$n;function $n(e){return{ReadStream:t,WriteStream:n};function t(i,r){if(!(this instanceof t))return new t(i,r);Qe.call(this);var o=this;this.path=i,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,r=r||{};for(var a=Object.keys(r),c=0,s=a.length;c<s;c++){var l=a[c];this[l]=r[l]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}e.open(this.path,this.flags,this.mode,function(u,f){if(u){o.emit("error",u),o.readable=!1;return}o.fd=f,o.emit("open",f),o._read()})}function n(i,r){if(!(this instanceof n))return new n(i,r);Qe.call(this),this.path=i,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,r=r||{};for(var o=Object.keys(r),a=0,c=o.length;a<c;a++){var s=o[a];this[s]=r[s]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=e.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}var En=Pn,Fn=Object.getPrototypeOf||function(e){return e.__proto__};function Pn(e){if(e===null||typeof e!="object")return e;if(e instanceof Object)var t={__proto__:Fn(e)};else var t=Object.create(null);return Object.getOwnPropertyNames(e).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t}var O=gt,kn=Sn,On=vn,Cn=En,de=vt,W,Se;typeof Symbol=="function"&&typeof Symbol.for=="function"?(W=Symbol.for("graceful-fs.queue"),Se=Symbol.for("graceful-fs.previous")):(W="___graceful-fs.queue",Se="___graceful-fs.previous");function Dn(){}function Et(e,t){Object.defineProperty(e,W,{get:function(){return t}})}var K=Dn;de.debuglog?K=de.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(K=function(){var e=de.format.apply(de,arguments);e="GFS4: "+e.split(/\n/).join(`
GFS4: `),console.error(e)});if(!O[W]){var xn=Ie[W]||[];Et(O,xn),O.close=function(e){function t(n,i){return e.call(O,n,function(r){r||Xe(),typeof i=="function"&&i.apply(this,arguments)})}return Object.defineProperty(t,Se,{value:e}),t}(O.close),O.closeSync=function(e){function t(n){e.apply(O,arguments),Xe()}return Object.defineProperty(t,Se,{value:e}),t}(O.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){K(O[W]),yn.equal(O[W].length,0)})}Ie[W]||Et(Ie,O[W]);var R=be(Cn(O));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!O.__patched&&(R=be(O),O.__patched=!0);function be(e){kn(e),e.gracefulify=be,e.createReadStream=Ye,e.createWriteStream=Ge;var t=e.readFile;e.readFile=n;function n(h,g,S){return typeof g=="function"&&(S=g,g=null),I(h,g,S);function I(_,D,k,C){return t(_,D,function($){$&&($.code==="EMFILE"||$.code==="ENFILE")?Z([I,[_,D,k],$,C||Date.now(),Date.now()]):typeof k=="function"&&k.apply(this,arguments)})}}var i=e.writeFile;e.writeFile=r;function r(h,g,S,I){return typeof S=="function"&&(I=S,S=null),_(h,g,S,I);function _(D,k,C,$,T){return i(D,k,C,function(F){F&&(F.code==="EMFILE"||F.code==="ENFILE")?Z([_,[D,k,C,$],F,T||Date.now(),Date.now()]):typeof $=="function"&&$.apply(this,arguments)})}}var o=e.appendFile;o&&(e.appendFile=a);function a(h,g,S,I){return typeof S=="function"&&(I=S,S=null),_(h,g,S,I);function _(D,k,C,$,T){return o(D,k,C,function(F){F&&(F.code==="EMFILE"||F.code==="ENFILE")?Z([_,[D,k,C,$],F,T||Date.now(),Date.now()]):typeof $=="function"&&$.apply(this,arguments)})}}var c=e.copyFile;c&&(e.copyFile=s);function s(h,g,S,I){return typeof S=="function"&&(I=S,S=0),_(h,g,S,I);function _(D,k,C,$,T){return c(D,k,C,function(F){F&&(F.code==="EMFILE"||F.code==="ENFILE")?Z([_,[D,k,C,$],F,T||Date.now(),Date.now()]):typeof $=="function"&&$.apply(this,arguments)})}}var l=e.readdir;e.readdir=f;var u=/^v[0-5]\./;function f(h,g,S){typeof g=="function"&&(S=g,g=null);var I=u.test(process.version)?function(k,C,$,T){return l(k,_(k,C,$,T))}:function(k,C,$,T){return l(k,C,_(k,C,$,T))};return I(h,g,S);function _(D,k,C,$){return function(T,F){T&&(T.code==="EMFILE"||T.code==="ENFILE")?Z([I,[D,k,C],T,$||Date.now(),Date.now()]):(F&&F.sort&&F.sort(),typeof C=="function"&&C.call(this,T,F))}}}if(process.version.substr(0,4)==="v0.8"){var y=On(e);P=y.ReadStream,N=y.WriteStream}var m=e.ReadStream;m&&(P.prototype=Object.create(m.prototype),P.prototype.open=b);var d=e.WriteStream;d&&(N.prototype=Object.create(d.prototype),N.prototype.open=ie),Object.defineProperty(e,"ReadStream",{get:function(){return P},set:function(h){P=h},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WriteStream",{get:function(){return N},set:function(h){N=h},enumerable:!0,configurable:!0});var E=P;Object.defineProperty(e,"FileReadStream",{get:function(){return E},set:function(h){E=h},enumerable:!0,configurable:!0});var v=N;Object.defineProperty(e,"FileWriteStream",{get:function(){return v},set:function(h){v=h},enumerable:!0,configurable:!0});function P(h,g){return this instanceof P?(m.apply(this,arguments),this):P.apply(Object.create(P.prototype),arguments)}function b(){var h=this;Fe(h.path,h.flags,h.mode,function(g,S){g?(h.autoClose&&h.destroy(),h.emit("error",g)):(h.fd=S,h.emit("open",S),h.read())})}function N(h,g){return this instanceof N?(d.apply(this,arguments),this):N.apply(Object.create(N.prototype),arguments)}function ie(){var h=this;Fe(h.path,h.flags,h.mode,function(g,S){g?(h.destroy(),h.emit("error",g)):(h.fd=S,h.emit("open",S))})}function Ye(h,g){return new e.ReadStream(h,g)}function Ge(h,g){return new e.WriteStream(h,g)}var ln=e.open;e.open=Fe;function Fe(h,g,S,I){return typeof S=="function"&&(I=S,S=null),_(h,g,S,I);function _(D,k,C,$,T){return ln(D,k,C,function(F,ao){F&&(F.code==="EMFILE"||F.code==="ENFILE")?Z([_,[D,k,C,$],F,T||Date.now(),Date.now()]):typeof $=="function"&&$.apply(this,arguments)})}}return e}function Z(e){K("ENQUEUE",e[0].name,e[1]),O[W].push(e),Ae()}var he;function Xe(){for(var e=Date.now(),t=0;t<O[W].length;++t)O[W][t].length>2&&(O[W][t][3]=e,O[W][t][4]=e);Ae()}function Ae(){if(clearTimeout(he),he=void 0,O[W].length!==0){var e=O[W].shift(),t=e[0],n=e[1],i=e[2],r=e[3],o=e[4];if(r===void 0)K("RETRY",t.name,n),t.apply(null,n);else if(Date.now()-r>=6e4){K("TIMEOUT",t.name,n);var a=n.pop();typeof a=="function"&&a.call(null,i)}else{var c=Date.now()-o,s=Math.max(o-r,1),l=Math.min(s*1.2,100);c>=l?(K("RETRY",t.name,n),t.apply(null,n.concat([r]))):O[W].push(e)}he===void 0&&(he=setTimeout(Ae,0))}}(function(e){const t=M.fromCallback,n=R,i=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchmod","lchown","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(r=>typeof n[r]=="function");Object.assign(e,n),i.forEach(r=>{e[r]=t(n[r])}),e.exists=function(r,o){return typeof o=="function"?n.exists(r,o):new Promise(a=>n.exists(r,a))},e.read=function(r,o,a,c,s,l){return typeof l=="function"?n.read(r,o,a,c,s,l):new Promise((u,f)=>{n.read(r,o,a,c,s,(y,m,d)=>{if(y)return f(y);u({bytesRead:m,buffer:d})})})},e.write=function(r,o,...a){return typeof a[a.length-1]=="function"?n.write(r,o,...a):new Promise((c,s)=>{n.write(r,o,...a,(l,u,f)=>{if(l)return s(l);c({bytesWritten:u,buffer:f})})})},e.readv=function(r,o,...a){return typeof a[a.length-1]=="function"?n.readv(r,o,...a):new Promise((c,s)=>{n.readv(r,o,...a,(l,u,f)=>{if(l)return s(l);c({bytesRead:u,buffers:f})})})},e.writev=function(r,o,...a){return typeof a[a.length-1]=="function"?n.writev(r,o,...a):new Promise((c,s)=>{n.writev(r,o,...a,(l,u,f)=>{if(l)return s(l);c({bytesWritten:u,buffers:f})})})},typeof n.realpath.native=="function"?e.realpath.native=t(n.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")})(Q);var Re={},Ft={};const In=q;Ft.checkPath=function(t){if(process.platform==="win32"&&/[<>:"|?*]/.test(t.replace(In.parse(t).root,""))){const i=new Error(`Path contains invalid characters: ${t}`);throw i.code="EINVAL",i}};const Pt=Q,{checkPath:kt}=Ft,Ot=e=>{const t={mode:511};return typeof e=="number"?e:{...t,...e}.mode};Re.makeDir=async(e,t)=>(kt(e),Pt.mkdir(e,{mode:Ot(t),recursive:!0}));Re.makeDirSync=(e,t)=>(kt(e),Pt.mkdirSync(e,{mode:Ot(t),recursive:!0}));const _n=M.fromPromise,{makeDir:Tn,makeDirSync:Oe}=Re,Ce=_n(Tn);var B={mkdirs:Ce,mkdirsSync:Oe,mkdirp:Ce,mkdirpSync:Oe,ensureDir:Ce,ensureDirSync:Oe};const Wn=M.fromPromise,Ct=Q;function Nn(e){return Ct.access(e).then(()=>!0).catch(()=>!1)}var X={pathExists:Wn(Nn),pathExistsSync:Ct.existsSync};const ee=R;function Ln(e,t,n,i){ee.open(e,"r+",(r,o)=>{if(r)return i(r);ee.futimes(o,t,n,a=>{ee.close(o,c=>{i&&i(a||c)})})})}function jn(e,t,n){const i=ee.openSync(e,"r+");return ee.futimesSync(i,t,n),ee.closeSync(i)}var Dt={utimesMillis:Ln,utimesMillisSync:jn};const te=Q,x=q,Mn=vt;function bn(e,t,n){const i=n.dereference?r=>te.stat(r,{bigint:!0}):r=>te.lstat(r,{bigint:!0});return Promise.all([i(e),i(t).catch(r=>{if(r.code==="ENOENT")return null;throw r})]).then(([r,o])=>({srcStat:r,destStat:o}))}function An(e,t,n){let i;const r=n.dereference?a=>te.statSync(a,{bigint:!0}):a=>te.lstatSync(a,{bigint:!0}),o=r(e);try{i=r(t)}catch(a){if(a.code==="ENOENT")return{srcStat:o,destStat:null};throw a}return{srcStat:o,destStat:i}}function Rn(e,t,n,i,r){Mn.callbackify(bn)(e,t,i,(o,a)=>{if(o)return r(o);const{srcStat:c,destStat:s}=a;if(s){if(ye(c,s)){const l=x.basename(e),u=x.basename(t);return n==="move"&&l!==u&&l.toLowerCase()===u.toLowerCase()?r(null,{srcStat:c,destStat:s,isChangingCase:!0}):r(new Error("Source and destination must not be the same."))}if(c.isDirectory()&&!s.isDirectory())return r(new Error(`Cannot overwrite non-directory '${t}' with directory '${e}'.`));if(!c.isDirectory()&&s.isDirectory())return r(new Error(`Cannot overwrite directory '${t}' with non-directory '${e}'.`))}return c.isDirectory()&&qe(e,t)?r(new Error(ge(e,t,n))):r(null,{srcStat:c,destStat:s})})}function qn(e,t,n,i){const{srcStat:r,destStat:o}=An(e,t,i);if(o){if(ye(r,o)){const a=x.basename(e),c=x.basename(t);if(n==="move"&&a!==c&&a.toLowerCase()===c.toLowerCase())return{srcStat:r,destStat:o,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(r.isDirectory()&&!o.isDirectory())throw new Error(`Cannot overwrite non-directory '${t}' with directory '${e}'.`);if(!r.isDirectory()&&o.isDirectory())throw new Error(`Cannot overwrite directory '${t}' with non-directory '${e}'.`)}if(r.isDirectory()&&qe(e,t))throw new Error(ge(e,t,n));return{srcStat:r,destStat:o}}function xt(e,t,n,i,r){const o=x.resolve(x.dirname(e)),a=x.resolve(x.dirname(n));if(a===o||a===x.parse(a).root)return r();te.stat(a,{bigint:!0},(c,s)=>c?c.code==="ENOENT"?r():r(c):ye(t,s)?r(new Error(ge(e,n,i))):xt(e,t,a,i,r))}function It(e,t,n,i){const r=x.resolve(x.dirname(e)),o=x.resolve(x.dirname(n));if(o===r||o===x.parse(o).root)return;let a;try{a=te.statSync(o,{bigint:!0})}catch(c){if(c.code==="ENOENT")return;throw c}if(ye(t,a))throw new Error(ge(e,n,i));return It(e,t,o,i)}function ye(e,t){return t.ino&&t.dev&&t.ino===e.ino&&t.dev===e.dev}function qe(e,t){const n=x.resolve(e).split(x.sep).filter(r=>r),i=x.resolve(t).split(x.sep).filter(r=>r);return n.reduce((r,o,a)=>r&&i[a]===o,!0)}function ge(e,t,n){return`Cannot ${n} '${e}' to a subdirectory of itself, '${t}'.`}var re={checkPaths:Rn,checkPathsSync:qn,checkParentPaths:xt,checkParentPathsSync:It,isSrcSubdir:qe,areIdentical:ye};const A=R,ue=q,Hn=B.mkdirs,Jn=X.pathExists,Bn=Dt.utimesMillis,se=re;function Un(e,t,n,i){typeof n=="function"&&!i?(i=n,n={}):typeof n=="function"&&(n={filter:n}),i=i||function(){},n=n||{},n.clobber="clobber"in n?!!n.clobber:!0,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0001"),se.checkPaths(e,t,"copy",n,(r,o)=>{if(r)return i(r);const{srcStat:a,destStat:c}=o;se.checkParentPaths(e,a,t,"copy",s=>{if(s)return i(s);_t(e,t,n,(l,u)=>{if(l)return i(l);if(!u)return i();zn(c,e,t,n,i)})})})}function zn(e,t,n,i,r){const o=ue.dirname(n);Jn(o,(a,c)=>{if(a)return r(a);if(c)return _e(e,t,n,i,r);Hn(o,s=>s?r(s):_e(e,t,n,i,r))})}function _t(e,t,n,i){if(!n.filter)return i(null,!0);Promise.resolve(n.filter(e,t)).then(r=>i(null,r),r=>i(r))}function _e(e,t,n,i,r){(i.dereference?A.stat:A.lstat)(t,(a,c)=>a?r(a):c.isDirectory()?Zn(c,e,t,n,i,r):c.isFile()||c.isCharacterDevice()||c.isBlockDevice()?Vn(c,e,t,n,i,r):c.isSymbolicLink()?nr(e,t,n,i,r):c.isSocket()?r(new Error(`Cannot copy a socket file: ${t}`)):c.isFIFO()?r(new Error(`Cannot copy a FIFO pipe: ${t}`)):r(new Error(`Unknown file: ${t}`)))}function Vn(e,t,n,i,r,o){return t?Yn(e,n,i,r,o):Tt(e,n,i,r,o)}function Yn(e,t,n,i,r){if(i.overwrite)A.unlink(n,o=>o?r(o):Tt(e,t,n,i,r));else return i.errorOnExist?r(new Error(`'${n}' already exists`)):r()}function Tt(e,t,n,i,r){A.copyFile(t,n,o=>o?r(o):i.preserveTimestamps?Gn(e.mode,t,n,r):ve(n,e.mode,r))}function Gn(e,t,n,i){return Kn(e)?Qn(n,e,r=>r?i(r):Ze(e,t,n,i)):Ze(e,t,n,i)}function Kn(e){return(e&128)===0}function Qn(e,t,n){return ve(e,t|128,n)}function Ze(e,t,n,i){Xn(t,n,r=>r?i(r):ve(n,e,i))}function ve(e,t,n){return A.chmod(e,t,n)}function Xn(e,t,n){A.stat(e,(i,r)=>i?n(i):Bn(t,r.atime,r.mtime,n))}function Zn(e,t,n,i,r,o){return t?Wt(n,i,r,o):er(e.mode,n,i,r,o)}function er(e,t,n,i,r){A.mkdir(n,o=>{if(o)return r(o);Wt(t,n,i,a=>a?r(a):ve(n,e,r))})}function Wt(e,t,n,i){A.readdir(e,(r,o)=>r?i(r):Te(o,e,t,n,i))}function Te(e,t,n,i,r){const o=e.pop();return o?tr(e,o,t,n,i,r):r()}function tr(e,t,n,i,r,o){const a=ue.join(n,t),c=ue.join(i,t);_t(a,c,r,(s,l)=>{if(s)return o(s);if(!l)return Te(e,n,i,r,o);se.checkPaths(a,c,"copy",r,(u,f)=>{if(u)return o(u);const{destStat:y}=f;_e(y,a,c,r,m=>m?o(m):Te(e,n,i,r,o))})})}function nr(e,t,n,i,r){A.readlink(t,(o,a)=>{if(o)return r(o);if(i.dereference&&(a=ue.resolve(process.cwd(),a)),e)A.readlink(n,(c,s)=>c?c.code==="EINVAL"||c.code==="UNKNOWN"?A.symlink(a,n,r):r(c):(i.dereference&&(s=ue.resolve(process.cwd(),s)),se.isSrcSubdir(a,s)?r(new Error(`Cannot copy '${a}' to a subdirectory of itself, '${s}'.`)):se.isSrcSubdir(s,a)?r(new Error(`Cannot overwrite '${s}' with '${a}'.`)):rr(a,n,r)));else return A.symlink(a,n,r)})}function rr(e,t,n){A.unlink(t,i=>i?n(i):A.symlink(e,t,n))}var ir=Un;const L=R,le=q,or=B.mkdirsSync,ar=Dt.utimesMillisSync,fe=re;function cr(e,t,n){typeof n=="function"&&(n={filter:n}),n=n||{},n.clobber="clobber"in n?!!n.clobber:!0,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0002");const{srcStat:i,destStat:r}=fe.checkPathsSync(e,t,"copy",n);if(fe.checkParentPathsSync(e,i,t,"copy"),n.filter&&!n.filter(e,t))return;const o=le.dirname(t);return L.existsSync(o)||or(o),Nt(r,e,t,n)}function Nt(e,t,n,i){const o=(i.dereference?L.statSync:L.lstatSync)(t);if(o.isDirectory())return dr(o,e,t,n,i);if(o.isFile()||o.isCharacterDevice()||o.isBlockDevice())return ur(o,e,t,n,i);if(o.isSymbolicLink())return pr(e,t,n,i);throw o.isSocket()?new Error(`Cannot copy a socket file: ${t}`):o.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${t}`):new Error(`Unknown file: ${t}`)}function ur(e,t,n,i,r){return t?sr(e,n,i,r):Lt(e,n,i,r)}function sr(e,t,n,i){if(i.overwrite)return L.unlinkSync(n),Lt(e,t,n,i);if(i.errorOnExist)throw new Error(`'${n}' already exists`)}function Lt(e,t,n,i){return L.copyFileSync(t,n),i.preserveTimestamps&&lr(e.mode,t,n),He(n,e.mode)}function lr(e,t,n){return fr(e)&&mr(n,e),yr(t,n)}function fr(e){return(e&128)===0}function mr(e,t){return He(e,t|128)}function He(e,t){return L.chmodSync(e,t)}function yr(e,t){const n=L.statSync(e);return ar(t,n.atime,n.mtime)}function dr(e,t,n,i,r){return t?jt(n,i,r):hr(e.mode,n,i,r)}function hr(e,t,n,i){return L.mkdirSync(n),jt(t,n,i),He(n,e)}function jt(e,t,n){L.readdirSync(e).forEach(i=>wr(i,e,t,n))}function wr(e,t,n,i){const r=le.join(t,e),o=le.join(n,e);if(i.filter&&!i.filter(r,o))return;const{destStat:a}=fe.checkPathsSync(r,o,"copy",i);return Nt(a,r,o,i)}function pr(e,t,n,i){let r=L.readlinkSync(t);if(i.dereference&&(r=le.resolve(process.cwd(),r)),e){let o;try{o=L.readlinkSync(n)}catch(a){if(a.code==="EINVAL"||a.code==="UNKNOWN")return L.symlinkSync(r,n);throw a}if(i.dereference&&(o=le.resolve(process.cwd(),o)),fe.isSrcSubdir(r,o))throw new Error(`Cannot copy '${r}' to a subdirectory of itself, '${o}'.`);if(fe.isSrcSubdir(o,r))throw new Error(`Cannot overwrite '${o}' with '${r}'.`);return Sr(r,n)}else return L.symlinkSync(r,n)}function Sr(e,t){return L.unlinkSync(t),L.symlinkSync(e,t)}var gr=cr;const vr=M.fromCallback;var Je={copy:vr(ir),copySync:gr};const Mt=R,$r=M.fromCallback;function Er(e,t){Mt.rm(e,{recursive:!0,force:!0},t)}function Fr(e){Mt.rmSync(e,{recursive:!0,force:!0})}var $e={remove:$r(Er),removeSync:Fr};const Pr=M.fromPromise,bt=Q,At=q,Rt=B,qt=$e,et=Pr(async function(t){let n;try{n=await bt.readdir(t)}catch{return Rt.mkdirs(t)}return Promise.all(n.map(i=>qt.remove(At.join(t,i))))});function tt(e){let t;try{t=bt.readdirSync(e)}catch{return Rt.mkdirsSync(e)}t.forEach(n=>{n=At.join(e,n),qt.removeSync(n)})}var kr={emptyDirSync:tt,emptydirSync:tt,emptyDir:et,emptydir:et};const Or=M.fromCallback,Ht=q,Y=R,Jt=B;function Cr(e,t){function n(){Y.writeFile(e,"",i=>{if(i)return t(i);t()})}Y.stat(e,(i,r)=>{if(!i&&r.isFile())return t();const o=Ht.dirname(e);Y.stat(o,(a,c)=>{if(a)return a.code==="ENOENT"?Jt.mkdirs(o,s=>{if(s)return t(s);n()}):t(a);c.isDirectory()?n():Y.readdir(o,s=>{if(s)return t(s)})})})}function Dr(e){let t;try{t=Y.statSync(e)}catch{}if(t&&t.isFile())return;const n=Ht.dirname(e);try{Y.statSync(n).isDirectory()||Y.readdirSync(n)}catch(i){if(i&&i.code==="ENOENT")Jt.mkdirsSync(n);else throw i}Y.writeFileSync(e,"")}var xr={createFile:Or(Cr),createFileSync:Dr};const Ir=M.fromCallback,Bt=q,V=R,Ut=B,_r=X.pathExists,{areIdentical:zt}=re;function Tr(e,t,n){function i(r,o){V.link(r,o,a=>{if(a)return n(a);n(null)})}V.lstat(t,(r,o)=>{V.lstat(e,(a,c)=>{if(a)return a.message=a.message.replace("lstat","ensureLink"),n(a);if(o&&zt(c,o))return n(null);const s=Bt.dirname(t);_r(s,(l,u)=>{if(l)return n(l);if(u)return i(e,t);Ut.mkdirs(s,f=>{if(f)return n(f);i(e,t)})})})})}function Wr(e,t){let n;try{n=V.lstatSync(t)}catch{}try{const o=V.lstatSync(e);if(n&&zt(o,n))return}catch(o){throw o.message=o.message.replace("lstat","ensureLink"),o}const i=Bt.dirname(t);return V.existsSync(i)||Ut.mkdirsSync(i),V.linkSync(e,t)}var Nr={createLink:Ir(Tr),createLinkSync:Wr};const G=q,ae=R,Lr=X.pathExists;function jr(e,t,n){if(G.isAbsolute(e))return ae.lstat(e,i=>i?(i.message=i.message.replace("lstat","ensureSymlink"),n(i)):n(null,{toCwd:e,toDst:e}));{const i=G.dirname(t),r=G.join(i,e);return Lr(r,(o,a)=>o?n(o):a?n(null,{toCwd:r,toDst:e}):ae.lstat(e,c=>c?(c.message=c.message.replace("lstat","ensureSymlink"),n(c)):n(null,{toCwd:e,toDst:G.relative(i,e)})))}}function Mr(e,t){let n;if(G.isAbsolute(e)){if(n=ae.existsSync(e),!n)throw new Error("absolute srcpath does not exist");return{toCwd:e,toDst:e}}else{const i=G.dirname(t),r=G.join(i,e);if(n=ae.existsSync(r),n)return{toCwd:r,toDst:e};if(n=ae.existsSync(e),!n)throw new Error("relative srcpath does not exist");return{toCwd:e,toDst:G.relative(i,e)}}}var br={symlinkPaths:jr,symlinkPathsSync:Mr};const Vt=R;function Ar(e,t,n){if(n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,t)return n(null,t);Vt.lstat(e,(i,r)=>{if(i)return n(null,"file");t=r&&r.isDirectory()?"dir":"file",n(null,t)})}function Rr(e,t){let n;if(t)return t;try{n=Vt.lstatSync(e)}catch{return"file"}return n&&n.isDirectory()?"dir":"file"}var qr={symlinkType:Ar,symlinkTypeSync:Rr};const Hr=M.fromCallback,Yt=q,J=Q,Gt=B,Jr=Gt.mkdirs,Br=Gt.mkdirsSync,Kt=br,Ur=Kt.symlinkPaths,zr=Kt.symlinkPathsSync,Qt=qr,Vr=Qt.symlinkType,Yr=Qt.symlinkTypeSync,Gr=X.pathExists,{areIdentical:Xt}=re;function Kr(e,t,n,i){i=typeof n=="function"?n:i,n=typeof n=="function"?!1:n,J.lstat(t,(r,o)=>{!r&&o.isSymbolicLink()?Promise.all([J.stat(e),J.stat(t)]).then(([a,c])=>{if(Xt(a,c))return i(null);nt(e,t,n,i)}):nt(e,t,n,i)})}function nt(e,t,n,i){Ur(e,t,(r,o)=>{if(r)return i(r);e=o.toDst,Vr(o.toCwd,n,(a,c)=>{if(a)return i(a);const s=Yt.dirname(t);Gr(s,(l,u)=>{if(l)return i(l);if(u)return J.symlink(e,t,c,i);Jr(s,f=>{if(f)return i(f);J.symlink(e,t,c,i)})})})})}function Qr(e,t,n){let i;try{i=J.lstatSync(t)}catch{}if(i&&i.isSymbolicLink()){const c=J.statSync(e),s=J.statSync(t);if(Xt(c,s))return}const r=zr(e,t);e=r.toDst,n=Yr(r.toCwd,n);const o=Yt.dirname(t);return J.existsSync(o)||Br(o),J.symlinkSync(e,t,n)}var Xr={createSymlink:Hr(Kr),createSymlinkSync:Qr};const{createFile:rt,createFileSync:it}=xr,{createLink:ot,createLinkSync:at}=Nr,{createSymlink:ct,createSymlinkSync:ut}=Xr;var Zr={createFile:rt,createFileSync:it,ensureFile:rt,ensureFileSync:it,createLink:ot,createLinkSync:at,ensureLink:ot,ensureLinkSync:at,createSymlink:ct,createSymlinkSync:ut,ensureSymlink:ct,ensureSymlinkSync:ut};function ei(e,{EOL:t=`
`,finalEOL:n=!0,replacer:i=null,spaces:r}={}){const o=n?t:"";return JSON.stringify(e,i,r).replace(/\n/g,t)+o}function ti(e){return Buffer.isBuffer(e)&&(e=e.toString("utf8")),e.replace(/^\uFEFF/,"")}var Be={stringify:ei,stripBom:ti};let ne;try{ne=R}catch{ne=gt}const Ee=M,{stringify:Zt,stripBom:en}=Be;async function ni(e,t={}){typeof t=="string"&&(t={encoding:t});const n=t.fs||ne,i="throws"in t?t.throws:!0;let r=await Ee.fromCallback(n.readFile)(e,t);r=en(r);let o;try{o=JSON.parse(r,t?t.reviver:null)}catch(a){if(i)throw a.message=`${e}: ${a.message}`,a;return null}return o}const ri=Ee.fromPromise(ni);function ii(e,t={}){typeof t=="string"&&(t={encoding:t});const n=t.fs||ne,i="throws"in t?t.throws:!0;try{let r=n.readFileSync(e,t);return r=en(r),JSON.parse(r,t.reviver)}catch(r){if(i)throw r.message=`${e}: ${r.message}`,r;return null}}async function oi(e,t,n={}){const i=n.fs||ne,r=Zt(t,n);await Ee.fromCallback(i.writeFile)(e,r,n)}const ai=Ee.fromPromise(oi);function ci(e,t,n={}){const i=n.fs||ne,r=Zt(t,n);return i.writeFileSync(e,r,n)}const ui={readFile:ri,readFileSync:ii,writeFile:ai,writeFileSync:ci};var si=ui;const we=si;var li={readJson:we.readFile,readJsonSync:we.readFileSync,writeJson:we.writeFile,writeJsonSync:we.writeFileSync};const fi=M.fromCallback,ce=R,tn=q,nn=B,mi=X.pathExists;function yi(e,t,n,i){typeof n=="function"&&(i=n,n="utf8");const r=tn.dirname(e);mi(r,(o,a)=>{if(o)return i(o);if(a)return ce.writeFile(e,t,n,i);nn.mkdirs(r,c=>{if(c)return i(c);ce.writeFile(e,t,n,i)})})}function di(e,...t){const n=tn.dirname(e);if(ce.existsSync(n))return ce.writeFileSync(e,...t);nn.mkdirsSync(n),ce.writeFileSync(e,...t)}var Ue={outputFile:fi(yi),outputFileSync:di};const{stringify:hi}=Be,{outputFile:wi}=Ue;async function pi(e,t,n={}){const i=hi(t,n);await wi(e,i,n)}var Si=pi;const{stringify:gi}=Be,{outputFileSync:vi}=Ue;function $i(e,t,n){const i=gi(t,n);vi(e,i,n)}var Ei=$i;const Fi=M.fromPromise,j=li;j.outputJson=Fi(Si);j.outputJsonSync=Ei;j.outputJSON=j.outputJson;j.outputJSONSync=j.outputJsonSync;j.writeJSON=j.writeJson;j.writeJSONSync=j.writeJsonSync;j.readJSON=j.readJson;j.readJSONSync=j.readJsonSync;var Pi=j;const ki=R,We=q,Oi=Je.copy,rn=$e.remove,Ci=B.mkdirp,Di=X.pathExists,st=re;function xi(e,t,n,i){typeof n=="function"&&(i=n,n={}),n=n||{};const r=n.overwrite||n.clobber||!1;st.checkPaths(e,t,"move",n,(o,a)=>{if(o)return i(o);const{srcStat:c,isChangingCase:s=!1}=a;st.checkParentPaths(e,c,t,"move",l=>{if(l)return i(l);if(Ii(t))return lt(e,t,r,s,i);Ci(We.dirname(t),u=>u?i(u):lt(e,t,r,s,i))})})}function Ii(e){const t=We.dirname(e);return We.parse(t).root===t}function lt(e,t,n,i,r){if(i)return De(e,t,n,r);if(n)return rn(t,o=>o?r(o):De(e,t,n,r));Di(t,(o,a)=>o?r(o):a?r(new Error("dest already exists.")):De(e,t,n,r))}function De(e,t,n,i){ki.rename(e,t,r=>r?r.code!=="EXDEV"?i(r):_i(e,t,n,i):i())}function _i(e,t,n,i){Oi(e,t,{overwrite:n,errorOnExist:!0,preserveTimestamps:!0},o=>o?i(o):rn(e,i))}var Ti=xi;const on=R,Ne=q,Wi=Je.copySync,an=$e.removeSync,Ni=B.mkdirpSync,ft=re;function Li(e,t,n){n=n||{};const i=n.overwrite||n.clobber||!1,{srcStat:r,isChangingCase:o=!1}=ft.checkPathsSync(e,t,"move",n);return ft.checkParentPathsSync(e,r,t,"move"),ji(t)||Ni(Ne.dirname(t)),Mi(e,t,i,o)}function ji(e){const t=Ne.dirname(e);return Ne.parse(t).root===t}function Mi(e,t,n,i){if(i)return xe(e,t,n);if(n)return an(t),xe(e,t,n);if(on.existsSync(t))throw new Error("dest already exists.");return xe(e,t,n)}function xe(e,t,n){try{on.renameSync(e,t)}catch(i){if(i.code!=="EXDEV")throw i;return bi(e,t,n)}}function bi(e,t,n){return Wi(e,t,{overwrite:n,errorOnExist:!0,preserveTimestamps:!0}),an(e)}var Ai=Li;const Ri=M.fromCallback;var qi={move:Ri(Ti),moveSync:Ai},cn={...Q,...Je,...kr,...Zr,...Pi,...B,...qi,...Ue,...X,...$e};const{dialog:ze}=require("electron"),un=require("path"),Hi=async()=>await ze.showOpenDialog({title:"选择一个文件",buttonLabel:"确认选择",filters:[{name:"应用/文件",extensions:[]}]}),Ji=async()=>{let e=await ze.showOpenDialog({title:"选择配置文件",buttonLabel:"确认选择",filters:[{name:"JSON配置文件",extensions:["json"]}]});if(e!=null)return cn.readJsonSync(un.join(e.filePaths[0]))},Bi=async(e,t)=>{let n=await Ui();n==""&&n==null||cn.writeJsonSync(un.join(n,`${e}.json`),t)},Ui=async()=>await ze.showOpenDialog({properties:["openDirectory"]}).then(t=>{if(!t.canceled)return t.filePaths[0]}).catch(t=>{console.error(t)}),{SerialPort:mt}=require("serialport"),p=class{};p.wait=null;p.waitState=!1;p.connectState=!1;p.HardwarePort={};p.connectHardware=async()=>{if(p.connectState)return new Promise(n=>n(!0));let e=[];try{e=await mt.list()}catch(n){return console.info(n),p.connectState=!1,p.HardwarePort={},new Promise(i=>i(!1))}if(e.length==0)return console.info("no serial port"),p.connectState=!1,new Promise(n=>n(!1));let t=3;for(;!p.connectState&&t>0;){console.info(t);for(let n=0;n<e.length;n++){let i=new mt({path:e[n].path,baudRate:115200},r=>{if(r)return p.errorHandle(r);console.log("port open success")});i.on("error",r=>p.errorHandle(r)),i.on("data",r=>{if(r[0]==170&&r[1]==187&&r[2]==204){p.HardwarePort=i,p.connectState=!0;return}p.dataHandle(r)}),i.on("close",()=>(console.info("serial close listen"),p.errorHandle())),i.write(new Uint8Array([170,187,204])),i.drain(r=>{if(r)return p.errorHandle(r);console.info("send ok")}),await new Promise(r=>setTimeout(r,500)),t--,p.connectState||(p.HardwarePort={},i.close(r=>{if(r)return p.errorHandle(r);console.info("close success")}))}}return p.connectState?(console.info("connect success"),new Promise(n=>n(!0))):(console.info("no hardware input"),new Promise(n=>n(!1)))};p.errorHandle=async e=>{var t;return p.connectState&&((t=p.HardwarePort)==null||t.close(n=>{if(n)return p.errorHandle(n);console.info("close success")})),p.connectState=!1,p.HardwarePort={},new Promise(n=>n(!1))};p.sendData=async e=>{var t,n;return p.connectState&&Object.keys(p.HardwarePort).length!=0?((t=p.HardwarePort)==null||t.write(Buffer.from(e)),(n=p.HardwarePort)==null||n.drain(i=>i?new Promise(r=>r(!1)):new Promise(r=>r(!0))),new Promise(i=>i(!0))):new Promise(i=>i(!1))};p.dataHandle=e=>{e[0]==119&&(p.waitState=!0,console.info("data send"))};p.waitSign=async()=>(await new Promise(e=>p.wait=setInterval(()=>{p.waitState&&(clearInterval(p.wait),p.wait=null,p.waitState=!1,e(!0))},1)).catch(()=>new Promise(e=>e(!1))),new Promise(e=>e(!0)));let Ve=p;const zi=require("os"),Vi=require("path"),Yi=require("crypto"),Gi=require("pngparse"),Ki=require("sharp"),Qi=require("fs-extra"),w=class{static generateTemFile(t){let n=Yi.createHash("md5").update("angular-tmp-img").digest("hex")+".bmp",i=Vi.join(zi.tmpdir(),n),r=Buffer.from(t.replace(/^data:image\/\w+;base64,/,""),"base64");return Qi.writeFileSync(i,r),i}static convert(t,n){let i=this;i.pngtolcd(t,function(r,o){r?n(r,null):n(null,i.configArray[3]==0?i.hex2hex(o.toString("hex")):o)})}};w.generate=(e,t,n)=>(w.configArray=n,w.threshold=t,new Promise((i,r)=>{w.convert(w.generateTemFile(e),function(o,a){o?r(o):i(a)})}));w.pngtolcd=(e,t)=>{let n=w;Gi.parseFile(e,function(i,r){if(i){let a=n.imgFileToBuffer(e);return t(null,a)}let o=n.imageDataToHexArray(r);t(null,o)})};w.imgFileToBuffer=e=>{Ki(e).toBuffer().then(t=>t)};w.imageDataToHexArray=e=>{const t=w.createImageDate(e);let n=t.data,i=t.height,r=t.width,o=n.length;if(w.configArray[4]==1){let a=w.threshold,c=[],s=4,l;for(let u=0;u<o;u+=s)l=n[u+1]=n[u+2]=n[u],l>a?l=1:l=0,c[u/s]=l;return w.imageSamplingArr[w.configArray[1]](c,r,i)}else return w.colorImageSampling(n,r,i)};w.colorImageSampling=(e,t,n)=>{const i=Buffer.alloc(t*n*2);let r=0,o=0;for(;r<i.length&&o<e.length;)i[r]|=e[o]>>3<<3,i[r]|=e[o+1]>>5,i[r+1]|=e[o+1]>>2<<5,i[r+1]|=e[o+2]>>3,(w.configArray[0]==0||w.configArray[2]==1)&&(i[r]=~i[r],i[r+1]=~i[r+1]),r+=2,o+=4;return i};w.ImageSamplingRow=(e,t,n)=>{const i=Buffer.alloc(t*n/8);for(let r=0;r<e.length;r++){let o=Math.floor(r%t),a=Math.floor(r/t),c=0,s=a,l=1<<o%8;w.configArray[2]!=0&&(l=1<<7-o%8),c=s*Math.floor(t/8)+Math.floor(o/8),w.configArray[0]!==0&&(e[r]===0?e[r]=1:e[r]=0),e[r]===0?i[c]|=l:i[c]&=~l}return i};w.ImageSamplingCol=(e,t,n)=>{const i=Buffer.alloc(t*n/8);for(let r=0;r<e.length;r++){let o=Math.floor(r%t),a=Math.floor(r/t),c=0,s=o,l=1<<a%8;w.configArray[2]!=0&&(l=1<<7-a%8),c=s*Math.floor(n/8)+Math.floor(a/8),w.configArray[0]!==0&&(e[r]===0?e[r]=1:e[r]=0),e[r]===0?i[c]|=l:i[c]&=~l}return i};w.ImageSamplingColRow=(e,t,n)=>{const i=Buffer.alloc(t*n/8);for(let r=0;r<e.length;r++){let o=Math.floor(r%t),a=Math.floor(r/t),c=0,s=Math.floor(a/8),l=1<<a-8*s;w.configArray[2]!=0&&(l=1<<7-(a-8*s)),s===0?c=o:c=o+t*s,w.configArray[0]!==0&&(e[r]===0?e[r]=1:e[r]=0),e[r]===0?i[c]|=l:i[c]&=~l}return i};w.ImageSamplingRowCol=(e,t,n)=>{const i=Buffer.alloc(t*n/8);for(let r=0;r<e.length;r++){let o=Math.floor(r%t),a=Math.floor(r/t),c=0,s=Math.floor(o/8),l=1<<o%8;w.configArray[2]!=0&&(l=1<<7-o%8),c=s*n+a,w.configArray[0]!==0&&(e[r]===0?e[r]=1:e[r]=0),e[r]===0?i[c]|=l:i[c]&=~l}return i};w.imageSamplingArr=[w.ImageSamplingRow,w.ImageSamplingCol,w.ImageSamplingColRow,w.ImageSamplingRowCol];w.createImageDate=e=>{let t=Buffer.alloc(e.width*e.height*4);for(let n=0,i=0;n<e.height;n++)for(let r=0;r<e.width;r++)t.writeUInt32BE(w.getPixel(e,r,n),i),i+=4;return e.data.set(t),e};w.getPixel=(e,t,n)=>{if(t=t|0,n=n|0,t<0||n<0||t>=e.width||n>=e.height)return 0;let i=(n*e.width+t)*e.channels,r,o,a,c;switch(e.channels){case 1:r=o=a=e.data[i],c=255;break;case 2:r=o=a=e.data[i],c=e.data[i+1];break;case 3:r=e.data[i],o=e.data[i+1],a=e.data[i+2],c=255;break;case 4:r=e.data[i],o=e.data[i+1],a=e.data[i+2],c=e.data[i+3];break}return(r<<24|o<<16|a<<8|c)>>>0};w.hex2hex=e=>{for(var t=[],n=0;n<e.length;n+=2)t.push("0x"+e.substr(n,2));return t};w.pngtohexarray=(e,t)=>{w.pngtolcd(e,function(n,i){n?t(n,null):t(null,this.hex2hex(i.toString("hex")))})};let Xi=w;const{ipcMain:yt}=require("electron"),dt=require("sharp"),ht=require("crypto"),wt=require("os"),Zi=require("fs-extra"),pt=require("path");let Le="";const eo=async(e,t,n,i)=>{if(e==0||t==0)return;let r=ht.createHash("md5").update("angular-cir-img").digest("hex")+".bmp",o=pt.join(wt.tmpdir(),r),a=Buffer.from(n.replace(/^data:image\/\w+;base64,/,""),"base64");Zi.writeFileSync(o,a),pt.join(wt.tmpdir(),ht.createHash("md5").update("angular-cir-img-zoom").digest("hex")+".bmp"),i?dt(o).resize(e,t).greyscale().toBuffer().then(c=>{Le=c.toString("base64")}):dt(o).resize(e,t).toBuffer().then(c=>{Le=c.toString("base64")})},to=()=>{yt.handle("pic-data-editor",async(e,t,n,i,r)=>(eo(t,n,i,r),await new Promise(o=>setTimeout(o,700)),Le)),yt.handle("pic-data-parse",async(e,t,n,...i)=>await Xi.generate(t,n,i))},no=require("electron-store"),sn=new no,ro=(e,t)=>{sn.set(e,t)},io=e=>sn.get(e),{app:me,protocol:oo,BrowserWindow:je,ipcMain:U,dialog:so}=require("electron");require("path");dn();to();U.on("set-item",(e,t,n)=>{ro(t,n)});U.handle("get-item",async(e,t)=>await io(t));U.on("window-create",(e,t,n)=>{new $t().createWindow(t,n)});U.handle("write-config",async(e,t,n)=>await Bi(t,n));U.handle("select-file",async()=>await Hi());U.handle("get-config",async()=>await Ji());U.on("store-set",(e,t)=>{for(const n of je.getAllWindows())n!=je.fromWebContents(e.sender)&&n.webContents.send("store-get",t)});U.handle("wait-sign",async()=>await Ve.waitSign());U.handle("connection-state",async()=>await Ve.connectHardware());U.handle("send-data",async(e,t)=>await Ve.sendData(t));const St=async()=>{new $t().createWindow({route:"/home",isMainWin:!0},{width:680,height:500,maxWidth:680,maxHeight:500})};me.commandLine.appendSwitch("--ignore-certificate-errors","true");oo.registerSchemesAsPrivileged([{scheme:"app",privileges:{secure:!0,standard:!0}}]);me.whenReady().then(()=>{St(),me.on("activate",()=>{je.getAllWindows().length===0&&St()})});me.on("window-all-closed",()=>{process.platform!=="darwin"&&me.quit()});
